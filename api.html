<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Api</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="assets/css/docs.css" rel="stylesheet">
    <link href="assets/js/google-code-prettify/prettify.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png">

  </head>

  <body data-spy="scroll" data-target=".bs-docs-sidebar">

    <!-- Navbar
    ================================================== -->
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="./index.html">Bootstrap</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="">
                <a href="./index.html">Home</a>
              </li>
              <li class="">
                <a href="./getting-started.html">Get started</a>
              </li>
              <li class="active">
                <a href="./api.html">Api</a>
              </li>
              <li class="">
                <a href="./visualizer.html">Visualizer</a>
              </li>
              <!--li class="">
                <a href="./components.html">Components</a>
              </li>
              <li class="">
                <a href="./javascript.html">Javascript</a>
              </li>
              <li class="">
                <a href="./customize.html">Customize</a>
              </li-->
            </ul>
          </div>
        </div>
      </div>
    </div>

<!-- Subhead
================================================== -->
<header class="jumbotron subhead" id="overview">
  <div class="container">
    <h1>Api</h1>
    <h3><i>Under Construction</i></h3>
    <p class="lead">The reference for what the underlying torrent client can do for you.</p>
  </div>
</header>

  <div class="container">

    <!-- Docs nav
    ================================================== -->
    <div class="row">
      <div class="span3 bs-docs-sidebar">
        <ul class="nav nav-list bs-docs-sidenav">
          <li><a href="#warning"><i class="icon-chevron-right"></i> Asynchronous Warning</a></li>
          <li><a href="#torrents"><i class="icon-chevron-right"></i> Torrents</a></li>
        </ul>
      </div>
      <div class="span9">



        <!-- Global Bootstrap settings
        ================================================== -->
        <section id="warning">
          <div class="page-header">
            <h1>Asynchronous Warning:</h1>
          </div>
          <p>Every bit of state, or function, is available <strong>only</strong> once it has been bubbled up from the underlying Torque torrent client. Which is to say you can't blindly do the following:
            <h5>DON'T</h5>
            <pre class="prettyprint linenums">
var btapp = new Btapp();
btapp.connect();

// The torrent list is bubbled up after the connect call.
// This code expects it to exist immediately and will fail.
btapp.get('torrent').each(function(torrent) {
  torrent.remove();
});</pre>
          <p>
            The code would work fine in most contexts, but the <i>torrent</i> attribute (the list of torrents, not a specific torrent) doesn't exist until you've connected to the torrent client and it has exposed its list of torrents to your btapp object.
          </p>
          <br>
          <p>
            Instead, we rely on Backbone's event handling to do this this safely (and get the expected behavior)
          </p>
              <h5>DO</h5>
              <pre class="prettyprint linenums">
var btapp = new Btapp();
btapp.connect();

// This code will wait for the traditional backbone <i>add</i> event to be thrown. 
// We can listen to a specific attribute (in this case <i>torrent</i>) by adding <i>:attribute</i>
btapp.on('add:torrent', function(torrents) {
  torrents.each(function(torrent) {
    torrent.remove();
  });
});
</pre>
          <p>
            Depending on you app, you may not care about ensuring the functionality is available, but it is important to avoid referencing attributes/functions of undefined values.
            <br><br>
            The complexity of protecting against these timing issues grows exponentially as you access children of children attributes, so make sure to take advantage of <a href="https://github.com/bittorrenttorque/backbrace">Backbrace</a> (included by default in the template project). 
          </p>
          <h5>The following api examples will be kept as simple as possible, so will not necessarly avoid these timing issues. Examples that are written carefully to avoid these issues will be denoted with a <strong>SUPER TIMING SAFE!</strong></h5>
        </section>
        <section id="torrents">
          <div class="page-header">
            <h1>Torrents</h1>
            <p>The list of torrents loaded in the Torque torrent client are represented in a <i>Backbone.Collection</i> that is accessible via <i>btapp.get('torrent')</i>
          </div>
          <h3>Adding a torrent</h3>
          <pre class="prettyprint linenums">
var url = 'http://vodo.net/media/torrents/Deadside.Pilot.2012.720p.x264-VODO.torrent';
btapp.get('add').torrent(url);</pre>
          <p><strong>Callback?</strong> If you'd like to know when the torrent has been added, you can do so by passing in an object with <i>url</i> and <i>callback</i> keys.<p>
          <pre class="prettyprint linenums">
var magnet = 'magnet:?xt=urn:btih:f0d665f264393a7dafd7d05d739e1097df652e80&dn=The.Yes.Men.Fix.The.World';

// Can also provide a few more details if we want to get fancy
var callback = function(err) {
  alert('added the torrent');
};
btapp.get('add').torrent({
  url: magnet,
  callback: callback
});</pre>
          <p><strong>Download directory?</strong> You can pass in <i>location</i> to specify the download directory. This is used in combination with <i>btapp.browseforfolder</i> to let your users control download locations on a torrent by torrent basis.</p>
          <p><strong>Label?</strong> You can pass in <i>label</i> to specify a label. This can also be set/added after the fact by accessing the torrent's properties.</p>
          <br>
          <h3>Removing torrents</h3>
          <p>These torrents all suck. Lets get rid of them all.</p>
          <pre class="prettyprint linenums">
btapp.get('torrent').each(function(torrent) {
  torrent.remove();
});
</pre>
          <br>
          <h3>Torrent download percentage</h3>
          <p>You may be interested in displaying the download percentage of a torrent that you add. This is simple, provided we are using <a href="https://github.com/bittorrenttorque/backbrace">Backbrace</a>. Lets add a torrent file from a url, then be very verbose about how much has downloaded.
            <h5>SUPER TIMING SAFE!</h5>
          <pre class="prettyprint linenums">
var btapp = new Btapp;
btapp.connect();

var url = 'http://vodo.net/media/torrents/Deadside.Pilot.2012.720p.x264-VODO.torrent';

// Wait for the add functionality to bubble up from the torrent client, then use it to add the torrent
btapp.live('add', function(add) {
  add.torrent(url);
});

// Backbrace passes the matching values in reverse order to the callback
// In this case we'll be called for each download_url in the properties of any torrent in the torrent list
btapp.live('torrent * properties download_url', function(download_url, properties, torrent, torrents) {
  // We are only interested in the torrent that has a download_url that matches the location we provided
  if(download_url == url) {
    var name = properties.get('name');
    // We found our torrent!
    // Now lets listen for progress changes
    properties.on('change:progress', function(progress) {
      // We have an update!
      alert('Download progress for ' + name + ': ' + progress);
    });
  }
});
</pre>
          </section>
      </div>
    </div>

  </div>



    <!-- Footer
    ================================================== -->
    <footer class="footer">
      <div class="container">
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p>Btapp.js is developed and maintained <a href="http://twitter.com/bittorrent" target="_blank">@bittorrent</a> by <a href="http://twitter.com/pwmckenna" target="_blank">@pwmckenna</a> and <a href="https://twitter.com/Kzahel" target="_blank">@kzahel</a>.</p>
        <p>Code licensed under the <a href="http://opensource.org/licenses/mit-license.php" target="_blank">MIT License</a>. Documentation licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.</p>
        <p>Icons from <a href="http://glyphicons.com">Glyphicons Free</a>, licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.</p>
        <p>Documentation is (somewhat obviously) derived from the <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a> documentation.
        <ul class="footer-links">
          <li><a href="http://pwmckenna.github.com">Read the blog</a></li>
          <li><a href="https://github.com/bittorrenttorque/btapp/issues?state=open">Submit issues</a></li>
          <li><a href="https://github.com/bittorrenttorque/btapp/wiki">Roadmap and changelog</a></li>
        </ul>
      </div>
    </footer>



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/google-code-prettify/prettify.js"></script>
    <script src="assets/js/bootstrap-transition.js"></script>
    <script src="assets/js/bootstrap-alert.js"></script>
    <script src="assets/js/bootstrap-modal.js"></script>
    <script src="assets/js/bootstrap-dropdown.js"></script>
    <script src="assets/js/bootstrap-scrollspy.js"></script>
    <script src="assets/js/bootstrap-tab.js"></script>
    <script src="assets/js/bootstrap-tooltip.js"></script>
    <script src="assets/js/bootstrap-popover.js"></script>
    <script src="assets/js/bootstrap-button.js"></script>
    <script src="assets/js/bootstrap-collapse.js"></script>
    <script src="assets/js/bootstrap-carousel.js"></script>
    <script src="assets/js/bootstrap-typeahead.js"></script>
    <script src="assets/js/bootstrap-affix.js"></script>
    <script src="assets/js/application.js"></script>



  </body>
</html>
